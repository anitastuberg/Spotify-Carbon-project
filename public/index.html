<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Anitas project</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link href="input.css" rel="stylesheet">
    <link rel="icon" href="http://example.com/favicon.png">
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans" rel="stylesheet">

</head>
<div class="navbar">
    <a class="logo" href="index.html">Carbonify</a>
    <a class="link" href="about.html">About</a>
  </div>
<body>
    <div class="header_i">
        <div class="header_text">
            <h1> The carbon imprint of streaming music </h1>
            <p class="header_paragraph">
                To reduce the footprint of listening to music, you should download the songs offline, to reduce
                streaming every time you listen to the song.
            </p>
        </div>
        <div id="overlay_header"></div>
    </div>

    <div class="login">
        <a id="login" href="http://localhost:3000/login">Login with Spotify</a>
    </div>

    <section class="wrapper">
        </div>
        <!--<div class="container">
            <canvas id="canvas1"></canvas>
        </div>-->
        <div class="input">
            <div class="input_text">
                <h2 id="smaller_title"> Check the carbon imprint of any song</h2>
                <p class="text">
                    You can check the carbon emissions generated by every song on Spotify. It is calculated by their
                    popularity index, made by Spotify.
                </p>
            
            <form id="upload" onsubmit="event.preventDefault(); searchAndDisplayResult(event)">
                <input type="text" id="input_field" placeholder="Song and artist">
                <button type="submit" id="submit_btn"> Search </button>
            </form>
        </div>
        </div>
    </section>

    <div id="searchResults">
        <script>
            async function searchAndDisplayResult(event) {
                event.preventDefault();

                const query = document.getElementById('input_field').value;
                console.log(query);

                try {
                    const response = await fetch(`http://localhost:3000/search?p=${query}`);
                    console.log(response);

                    // Clear existing results before displaying new ones
                    clearResults();

                    if (response.ok) {
                        const data = await response.json();
                        console.log(data);

                        // Assuming the tracks are present in the 'items' array
                        const tracks = data.tracks.items;

                        if (tracks.length > 0) {
                            // Assuming the first item in the array is the desired track
                            const track = tracks[0];

                            // Extracting artist name and song name
                            const artistName = track.artists.map(artist => artist.name).join(', ');
                            const songName = track.name;

                            // Displaying the results
                            console.log('Artist:', artistName);
                            console.log('Song:', songName);

                            // Call your displayResults function with the extracted data
                            displayResults(data);
                        } else {
                            console.error('No tracks found.');
                            document.getElementById('searchResults').innerHTML = 'No tracks found.';
                        }
                    } else {
                        console.error('Server response not OK:', response.statusText);
                        document.getElementById('searchResults').innerHTML = "To search for music you need to log in with your spotify";
                    }
                } catch (error) {
                    console.error('Error:', error.message);
                }
            }

            function clearResults() {
                const resultsContainer = document.getElementById('searchResults');
                resultsContainer.innerHTML = ''; // Clear the existing content
            }

            function displayResults(data) {
                const resultsContainer = document.getElementById('searchResults');

                if (data.tracks && data.tracks.items.length > 0) {

                    data.tracks.items.slice(0, 5).forEach(track => {
                        const trackDiv = document.createElement('div');
                        trackDiv.className = 'track-card';

                        // Get the album image URL (you can choose a different size as needed)
                        const imageUrl = track.album.images.length > 0 ? track.album.images[0].url : '/placeholder-image.jpg';

                        const img_wrapper = document.createElement('div');
                        img_wrapper.className = 'img_wrapper';

                        const imageElement = document.createElement('img');
                        imageElement.className = 'track-image';
                        imageElement.src = imageUrl;
                        imageElement.alt = track.name;
                        img_wrapper.appendChild(imageElement);

                        const trackInfoDiv = document.createElement('div');
                        trackInfoDiv.className = 'track-info';

                        const titleElement = document.createElement('h3');
                        titleElement.textContent = track.name;

                        const artistElement = document.createElement('p');
                        artistElement.innerHTML = `Artist: <span class="font-semibold">${track.artists.map(artist => artist.name).join(', ')}</span>`;

                        const durationElement = document.createElement('p');
                        const durationInSeconds = track.duration_ms / 1000;
                        const formattedDuration = `${Math.floor(durationInSeconds / 60)}:${Math.floor(durationInSeconds % 60)}`;
                        durationElement.textContent = `Duration: ${formattedDuration}`;

                        const popularityElement = document.createElement('p');
                        popularityElement.textContent = `Popularity index: ${track.popularity}`;

                        trackInfoDiv.appendChild(img_wrapper);
                        trackInfoDiv.appendChild(titleElement);
                        trackInfoDiv.appendChild(artistElement);
                        trackInfoDiv.appendChild(durationElement);
                        trackInfoDiv.appendChild(popularityElement);

                        trackDiv.appendChild(imageElement);
                        trackDiv.appendChild(trackInfoDiv);
                        // Add a click event listener to each track card
                        trackDiv.addEventListener('click', () => showLargeView(track));

                        resultsContainer.appendChild(trackDiv);
                    });
                } else {
                    resultsContainer.innerHTML = '<p>No results found</p>';
                }
            }

            function showLargeView(track) {
                const resultsContainer = document.getElementById('searchResults');

                // Hide other results
                hideOtherResults();

                // Create an overlay element
                const overlay = document.createElement('div');
                overlay.id = 'overlay';

                const largeViewDiv = document.createElement('div');
                largeViewDiv.className = 'large-view';

                // Create elements for the large view (adjust styling as needed)
                const largeImageElement = document.createElement('img');
                largeImageElement.src = track.album.images.length > 0 ? track.album.images[0].url : '/placeholder-image.jpg';
                largeImageElement.alt = track.name;

                const largeInfoDiv = document.createElement('div');
                largeInfoDiv.className = 'large-info';

                const largeTitleElement = document.createElement('h1');
                largeTitleElement.textContent = track.name;

                const largeArtistElement = document.createElement('p');
                largeArtistElement.innerHTML = `<h2>${track.artists.map(artist => artist.name).join(', ')}</h2>`;

                const largeDurationElement = document.createElement('p');
                const durationInSeconds = track.duration_ms / 1000;
                const formattedDuration = `${Math.floor(durationInSeconds / 60)}:${Math.floor(durationInSeconds % 60)}`;
                largeDurationElement.textContent = `Duration: ${formattedDuration}`;

                const largePopularityElement = document.createElement('p');
                largePopularityElement.textContent = `Popularity: ${track.popularity}`;

                const largeTextElement = document.createElement('p');
                largeTextElement.textContent = 'Your additional text here...';

                const exitButton = document.createElement('div');
                exitButton.className = 'exit_btn';
                const exit_img = document.createElement('img');
                exit_img.style.width = '100%';
                exit_img.style.height = '100%';
                exitButton.appendChild(exit_img);
                exitButton.class = 'exit_btn';
                exit_img.src = 'exit_icon.png';  // Update the path accordingly
                exit_img.alt = 'Exit';
                exitButton.addEventListener('click', () => exitLargeView(largeViewDiv, overlay));

                const header_card = document.createElement('div');
                header_card.className = 'header_card';
                header_card.appendChild(largeTitleElement);
                header_card.appendChild(largeArtistElement);
                // Append elements to the large view
                largeInfoDiv.appendChild(header_card);
                largeInfoDiv.appendChild(largeDurationElement);
                largeInfoDiv.appendChild(largePopularityElement);
                largeInfoDiv.appendChild(largeTextElement);

                largeViewDiv.appendChild(exitButton);
                largeViewDiv.appendChild(largeImageElement);
                largeViewDiv.appendChild(largeInfoDiv);
                resultsContainer.appendChild(largeViewDiv);

                // Append the large view and overlay to the results container
                overlay.appendChild(largeViewDiv);
                resultsContainer.appendChild(overlay);
                // Add a click event listener to exit when clicking outside the large view
                document.addEventListener('click', handleOutsideClick);

            }

            function hideOtherResults() {
                const trackCards = document.querySelectorAll('.track-card');
                trackCards.forEach(card => {
                    card.style.display = 'none';
                });
            }

            function showAllResults() {
                const trackCards = document.querySelectorAll('.track-card');
                trackCards.forEach(card => {
                    card.style.display = 'block';
                });
            }

            function exitLargeView(largeViewDiv) {
                // Show other results again
                showAllResults();

                // Hide the large view instead of clearing the results
                largeViewDiv.style.display = 'none';

                // Remove the overlay and large view
                const overlay = document.getElementById('overlay');
                overlay.remove();

                // Remove click event listener for outside click
                document.removeEventListener('click', handleOutsideClick);
            }

            function handleOutsideClick(event) {
                const resultsContainer = document.getElementById('searchResults');
                const largeViewDiv = document.querySelector('.large-view');

                if (largeViewDiv && !largeViewDiv.contains(event.target) && !resultsContainer.contains(event.target)) {
                    exitLargeView(largeViewDiv);
                }
            }
        </script>
    </div>

    <section class="section_about">
        <div class="text">
            <h2>So what do I do now?</h2>
            <p>Although this does not sound like huge amounts, when every person on the planet streams music it adds
                up
                to a lot!
            </p>
            <br />

            <p>We wish that in the future you will download your music locally on your device to reduce the carbon
                imprint and you can still enjoy your music!
            </p>
            <br />

            <p>
                Have a good listen!
            </p>
        </div>
        <div class="steps">
            <div>
                <h3>
                    Step 1
                </h3>
                <p>
                    Download the songs to your device
                </p>
            </div>
            <div>
                <h3>
                    Step 2
                </h3>
                <p>
                    Listen with a smaller carbon imprint </p>
            </div>
        </div>

    </section>

</body>
<footer class="footer">
    <container class="footer_wrapper">
        <div class="footer_txt">
            <p> Made by </p>
            <p> Anita Stuberg Guldseth </p>
        </div>
        <div class="footer_txt">
            <p id="read-more">Read more about the project</p>
        </div>
        <div class="footer_txt">
            <p>Self Data </p>
            <p>2023-2024</p>
            <p>ELISAVA</p>
        </div>
    </container>
</footer>

</html>